name: Destroy ephemeral

on:
  delete:
    branches: # we focus on the branches deletion in order to not handle deleted tags hiohi
      - "**"

jobs:
  trigger-circleci:
    if: github.event.ref_type == 'branch'
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: read
      pull-requests: write
    steps:
      - name: Check out code
        uses: actions/checkout@v4
      - name: Get PR number
        id: get_pr_number
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: echo "::set-output name=pull_request_number::$(gh pr view --json number -q .number || echo "")"
      - name: CircleCI Trigger on delete branches and tags
        run: echo ${{ steps.pr.outputs.get_pr_number }}